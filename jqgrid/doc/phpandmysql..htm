<html><head>
   <title>PHP and MySQL.</title>
   <meta name="generator"  content="HelpMaker">
   <meta name="keywords"  content="Welcome">
   <link rel="stylesheet"  type="text/css"  href="hm.css"></head>
<body bgcolor="#FFFCEA">

<table width="100%"  border="0"  cellspacing="0"  cellpadding="2"  bgcolor="#C0C0C0">
  <tr>
    <td align="left">
      <body><div align="left"><font face="Bitstream Vera Sans"><span style=" font-size:10pt">PHP and MySQL</span></font></div></body></html>

    </td>
    <td align="right">
      <font face="Arial"  size="2">
        <a href="serversidemanip.htm">Previous</a>&nbsp;<a href="WhatisjqGrid.htm">Top</a>&nbsp;<a href="coopexample.htm">Next</a>
      </font>
    </td>
  </tr></table>
<hr><body><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">&lt;?php </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">//include the information needed for the connection to MySQL data base server. </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// we store here username, database and password</span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">include(&quot;dbconfig.php&quot;);</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// to the url parameter are added 4 parameters as described in colModel</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// we shuld <b>get</b> these parameters to construct the needed query</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// Since we point in the options of the grid that we will use a GET method we should use 
the </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// appropriate command to obtain the parameters. In our case this is $_GET. If we point 
that we</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// want to use post we should use $_POST. Maybe the better way is to use 
$_REQUEST, which</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// contain booth the GET and POST variables. For more information refer to php 
documentation</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// get the requested page. By default grid sets this to 1. </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$page = $_GET['page']; </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// get how many rows we want to have into the grid - <b>rowNum</b> parameter in the grid </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$limit = $_GET['rows'];</span></font><font face="Arial"><span style=" font-size:11pt"> </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// get index row - i.e. user click to sort. At first time <b>sortname</b> parameter -</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// after that the index from colModel </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$sidx = $_GET['sidx']; </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// sorting order - at first time<b> sortorder </b></span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$sord = $_GET['sord']; </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// if we not pass at first time index use the first column for the index or what you want</span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">if(!$sidx) $sidx =1; </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// connect to the MySQL database server </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$db = mysql_connect($dbhost, $dbuser, $dbpassword) or die(&quot;Connection Error: &quot; . 
mysql_error()); </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// select the database </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">mysql_select_db($database) or die(&quot;Error conecting to db.&quot;); </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// calculate the number of rows for the query. We need this to paging the result </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$result = mysql_query(&quot;SELECT COUNT(*) AS count FROM invheader&quot;); </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$row = mysql_fetch_array($result,MYSQL_ASSOC); </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$count = $row['count'];</span></font><font face="Arial"><span style=" font-size:11pt"> </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// calculation of total pages for the query </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">if( $count &gt; 0 ) { </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">              </span></font><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$total_pages = ceil($count/$limit); </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">} else { </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">              </span></font><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$total_pages = 0; </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">} </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// if for some reasons the requested page is greater than the total </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// set the requested page to total page </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">if ($page &gt; $total_pages) $page=$total_pages;</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// calculate the starting position of the rows </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$start = $limit*$page - $limit;</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// if for some reasons start position is negative set it to 0 </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// typical case is that the user type 0 for the requested page </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">if($start &lt;0) $start = 0; </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// the actual query for the grid data </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$SQL = &quot;SELECT invid, invdate, amount, tax,total, note FROM invheader ORDER BY 
$sidx $sord LIMIT $start , $limit&quot;; </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">$result = mysql_query( $SQL ) or die(&quot;Couldn t execute query.&quot;.mysql_error()); </span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">// we should set the appropriate header information</span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">if ( stristr($_SERVER[&quot;HTTP_ACCEPT&quot;],&quot;application/xhtml+xml&quot;) ) {</span></font><font face="Arial"><span style=" font-size:11pt"><br></span></font><font face="Arial"><span style=" font-size:11pt">              </span></font><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">header(&quot;Content-type: application/xhtml+xml;charset=utf-8&quot;); </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">} else {</span></font><font face="Arial"><span style=" font-size:11pt"><br>
          header(&quot;Content-type: text/xml;charset=utf-8&quot;);</span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">}</span></font><font face="Arial"><span style=" font-size:11pt"><br>
echo &quot;&lt;?xml version='1.0' encoding='utf-8'?&gt;&quot;;</span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">echo &quot;&lt;rows&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
echo &quot;&lt;page&gt;&quot;.$page.&quot;&lt;/page&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
echo &quot;&lt;total&gt;&quot;.$total_pages.&quot;&lt;/total&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
echo &quot;&lt;records&gt;&quot;.$count.&quot;&lt;/records&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br></span></font><font face="Arial"><span style=" font-size:11pt">// be sure to put text data in CDATA<br></span></font><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">while($row = mysql_fetch_array($result,MYSQL_ASSOC)) {</span></font><font face="Arial"><span style=" font-size:11pt"><br>
echo &quot;&lt;row id='&quot;. $row[invid].&quot;'&gt;&quot;;            </span></font><font face="Arial"><span style=" font-size:11pt"><br>
            echo &quot;&lt;cell&gt;&quot;. $row[invid].&quot;&lt;/cell&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
            echo &quot;&lt;cell&gt;&quot;. $row[invdate].&quot;&lt;/cell&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
            echo &quot;&lt;cell&gt;&quot;. $row[amount].&quot;&lt;/cell&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
            echo &quot;&lt;cell&gt;&quot;. $row[tax].&quot;&lt;/cell&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
            echo &quot;&lt;cell&gt;&quot;. $row[total].&quot;&lt;/cell&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
            echo &quot;&lt;cell&gt;&lt;![CDATA[&quot;. $row[note].&quot;]]&gt;&lt;/cell&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
echo &quot;&lt;/row&gt;&quot;;</span></font><font face="Arial"><span style=" font-size:11pt"><br>
}</span></font><font face="Arial"><span style=" font-size:11pt"><br>
echo &quot;&lt;/rows&gt;&quot;; </span></font></div><div align="left"><font face="Arial"  color="#ff8c00"><span style=" font-size:11pt">?&gt;</span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt"><br></span></font></div><div align="left"><font face="Arial"><span style=" font-size:11pt">That is all. Save the file with name example.php and  your first grid is done.</span></font></div><div align="left">&nbsp;&nbsp;</div></body></html>

</body></html>
